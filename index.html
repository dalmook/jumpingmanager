<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport"
        content="width=device-width, initial-scale=1, maximum-scale=1, viewport-fit=cover" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="theme-color" content="#ffffff" />
  <title>점핑배틀 화성병점점</title>

  <link rel="stylesheet" href="styles.css" />

  <!-- Firebase SDK -->
  <script defer src="https://www.gstatic.com/firebasejs/10.13.2/firebase-app-compat.js"></script>
  <script defer src="https://www.gstatic.com/firebasejs/10.13.2/firebase-auth-compat.js"></script>
  <script defer src="https://www.gstatic.com/firebasejs/10.13.2/firebase-firestore-compat.js"></script>
  <script defer src="app.js"></script>
</head>
<body class="ios">
  <!-- iOS Large Title Header -->
  <header class="ios-header">
    <div class="safe-pad"></div>
    <div class="header-inner">
      <div class="header-top">
        <div class="brand">
          <span class="logo-dot"></span>
          <span class="brand-text">멤버 관리</span>
        </div>
        <div class="auth-area">
          <div id="signedOut" class="auth-row">
            <!-- 관리자: 이메일, 손님: 휴대폰 01012345678 (문구 그대로 유지) -->
            <input id="loginEmail" type="text" inputmode="text" placeholder="휴대폰 01012345678" />
            <input id="loginPass" type="password" placeholder="비밀번호" />
            <button id="btnLogin" class="btn primary">로그인</button>
            <button id="btnSignup" class="btn ghost">회원가입</button>
          </div>
          <div id="signedIn" class="auth-row hidden">
            <span id="whoami" class="muted"></span>
            <button id="btnLogout" class="btn ghost">로그아웃</button>
          </div>
        </div>
      </div>
      <h1 class="large-title">점핑배틀 화성병점점</h1>
      <p class="subtitle">스탬프 10회 → 무료 1회</p>
    </div>
  </header>

  <main class="app-shell">
    <!-- ========================= -->
    <!-- 관리자 화면 -->
    <!-- ========================= -->
    <section id="adminPanel" class="panel hidden">
      <div class="card glass">
        <div class="segmented">
          <button class="seg on" type="button" aria-pressed="true">회원</button>
          <button class="seg" type="button" disabled>통계(준비중)</button>
        </div>
      </div>

      <div class="admin-grid">
        <!-- 좌: 목록/검색 -->
        <aside class="card glass stick-left">
          <div class="section-head">
            <h2>회원 목록</h2>
          </div>
          <div class="search-row">
            <input id="searchPhone" placeholder="휴대폰 전체/끝 4자리" inputmode="numeric" />
            <button id="btnSearch" class="btn ghost">검색</button>
            <button id="btnLoadAll" class="btn ghost">전체 100</button>
          </div>

          <div class="quick-register">
            <details>
              <summary>빠른 등록/수정</summary>
              <div class="grid three">
                <input id="regName" placeholder="이름" />
                <input id="regPhone" placeholder="휴대폰번호" inputmode="numeric" />
                <input id="regTeam" placeholder="팀명" />
                <button id="btnRegister" class="btn primary">등록/수정</button>
              </div>
            </details>
          </div>

          <div id="adminList" class="list mt8" aria-live="polite"></div>
        </aside>

        <!-- 우: 상세 (⚠️ 중복 class 속성 수정: hidden은 같은 class에 포함) -->
        <section id="memberSection" class="card glass hidden">
          <div class="section-head">
            <h2>회원 상세</h2>
          </div>

          <div class="member-card" id="memberCard">
            <div class="member-head">
              <div>
                <div class="m-name">-</div>
                <div id="mPhoneTeam" class="muted">-</div>
              </div>
              <div class="stats">
                <div class="stat pill"><div class="label">스탬프(10)</div><div id="mStamp" class="value">0</div></div>
                <div class="stat pill"><div class="label">무료권</div><div id="mFree" class="value">0</div></div>
                <div class="stat pill"><div class="label">평일무료권</div><div id="mFreeWk" class="value">0</div></div>
                <div class="stat pill"><div class="label">슬러시 무료권</div><div id="mFreeSl" class="value">0</div></div>
                <div class="stat pill"><div class="label">다회권 잔여</div><div id="mPassTotal" class="value">0</div></div>
              </div>
            </div>

            <div class="progress">
              <div id="stampDots" class="dots"></div>
            </div>

            <!-- 기본 정보 -->
            <div class="section-card">
              <div class="section-row">
                <h3>기본 정보</h3>
                <button id="btnSaveProfile" class="btn primary small">프로필 저장</button>
              </div>
              <div class="grid three">
                <input id="editName" placeholder="이름" />
                <input id="editTeam" placeholder="팀명" />
                <input disabled value="전화번호는 문서 키 기준" />
              </div>
            </div>

            <!-- 스탬프/무료권 -->
            <div class="section-card">
              <h3>스탬프 / 무료권</h3>

              <!-- 단일 버튼(+1, 무료1회 사용, 0으로) -->
              <div class="row wrap gap8">
                <button id="btnAddVisit" class="btn primary">방문 +1</button>
                <button id="btnUseFree"  class="btn warn">무료 1회 사용</button>
                <button id="btnResetStamp" class="btn ghost">스탬프 0</button>
              </div>

              <!-- N 증감: 스탬프/무료권 -->
              <div class="row wrap gap8 mt8">
                <div class="row gap8">
                  <input id="stampDelta" type="number" min="1" step="1" value="1" class="w110" />
                  <button id="btnAddStampN" class="btn primary">스탬프 +N</button>
                  <button id="btnSubStampN" class="btn ghost">스탬프 -N</button>
                </div>
                <div class="row gap8">
                  <input id="freeDelta" type="number" min="1" step="1" value="1" class="w110" />
                  <button id="btnAddFreeN" class="btn primary">무료권 +N</button>
                  <button id="btnSubFreeN" class="btn ghost">무료권 -N</button>
                </div>
              </div>

              <!-- ✅ 추가: 평일무료권 N 증감 -->
              <div class="row wrap gap8 mt8">
                <div class="row gap8">
                  <input id="freeWkDelta" type="number" min="1" step="1" value="1" class="w110" />
                  <button id="btnAddFreeWkN" class="btn primary">평일무료권 +N</button>
                  <button id="btnSubFreeWkN" class="btn ghost">평일무료권 -N</button>
                </div>
              </div>

              <!-- ✅ 추가: 슬러시 무료권 N 증감 -->
              <div class="row wrap gap8 mt8">
                <div class="row gap8">
                  <input id="freeSlDelta" type="number" min="1" step="1" value="1" class="w110" />
                  <button id="btnAddFreeSlN" class="btn primary">슬러시 무료권 +N</button>
                  <button id="btnSubFreeSlN" class="btn ghost">슬러시 무료권 -N</button>
                </div>
              </div>
            </div>

            <!-- 다회권 -->
            <div class="section-card">
              <div class="section-row">
                <h3>다회권</h3>
                <div class="row gap8">
                  <button id="passPreset10" class="btn ghost small">10회권</button>
                  <button id="passPreset20" class="btn ghost small">20회권</button>
                  <button id="passPreset30" class="btn ghost small">30회권</button>
                </div>
              </div>
              <div class="row wrap gap8">
                <input id="passName"  placeholder="권종명 (예: 10회권)" />
                <input id="passCount" type="number" min="1" step="1" value="1" class="w110" />
                <button id="btnAddPass" class="btn primary">권종 추가</button>
              </div>
              <div class="row wrap gap8 mt8">
                <select id="passSelect"></select>
                <button id="btnUsePass" class="btn">선택권 -1</button>
                <button id="btnRefundPass" class="btn ghost">선택권 +1</button>
                <input id="passDelta" type="number" min="1" step="1" value="1" class="w110" />
                <button id="btnUsePassN" class="btn">선택권 -N</button>
                <button id="btnRefundPassN" class="btn ghost">선택권 +N</button>
                <button id="btnDeletePass" class="btn danger">선택권 삭제</button>
              </div>
            </div>

            <div class="grid two mt16">
              <div class="section-card">
                <h3>보유 다회권</h3>
                <div id="passList" class="list small"></div>
              </div>
              <div class="section-card">
                <h3>최근 로그</h3>
                <div id="logList" class="list small"></div>
              </div>
            </div>

            <!-- 위험 작업 -->
            <div class="danger-zone section-card">
              <div class="row wrap gap8">
                <button id="btnDeleteMember" class="btn danger">회원 삭제</button>
                <span class="muted">로그 서브컬렉션은 남습니다</span>
              </div>
            </div>
          </div>
        </section>
      </div>

      <!-- 플로팅 단축(FAB) -->
      <div class="fab-area">
        <button id="fabAddVisit" class="fab" title="방문 +1"
                onclick="document.getElementById('btnAddVisit')?.click()">＋</button>
      </div>
    </section>

    <!-- ========================= -->
    <!-- 손님 화면 -->
    <!-- ========================= -->
    <section id="memberSelf" class="panel hidden">
      <div class="card ios-card">
        <div class="ios-title">
          <div class="title-main">나의 이용 현황</div>
          <div class="mini-pill">LIVE</div>
        </div>

        <!-- 탭 콘텐츠 -->
        <div class="self-tabs">
          <div id="selfTab-summary" class="tabpane active">
            <div id="selfCard" class="member-card compact"></div>
          </div>

          <div id="selfTab-passes" class="tabpane">
            <div class="section-card">
              <h3>보유 다회권</h3>
              <div id="selfPassList" class="list small"></div>
            </div>
          </div>

          <div id="selfTab-logs" class="tabpane">
            <div class="section-card">
              <h3>최근 이용 로그</h3>
              <div id="selfLogList" class="list small"></div>
            </div>
          </div>
        </div>

        <!-- iOS 스타일 탭바 -->
        <nav class="tabbar">
          <button type="button" class="tab on" data-tab="summary">
            <span class="ico">🏠</span><span class="txt">요약</span>
          </button>
          <button type="button" class="tab" data-tab="passes">
            <span class="ico">🎫</span><span class="txt">다회권</span>
          </button>
          <button type="button" class="tab" data-tab="logs">
            <span class="ico">🧾</span><span class="txt">로그</span>
          </button>
        </nav>
      </div>
    </section>
  </main>

  <!-- 디버그 패널 -->
  <button id="__dbgToggle" class="dbg-toggle">디버그</button>
  <div id="__dbgPanel" class="dbg-panel hidden">
    <div class="dbg-head">
      <b>로그</b>
      <div>
        <button id="__dbgCopy">복사</button>
        <button id="__dbgClear">지우기</button>
        <button id="__dbgClose">닫기</button>
      </div>
    </div>
    <textarea id="__dbgArea" readonly></textarea>
  </div>
</body>
</html>
